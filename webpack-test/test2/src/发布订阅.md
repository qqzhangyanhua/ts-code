```js
let activeEffect = null;
class Dep {
    constructor(val) {
        this._val = val;
        this.effects = new Set();
    }
    get value() {
        this.depend();
        return this._val;
    }
    set value(newVal) {
        this._val = newVal;
        this.notify();
    }
    //收集依赖
    depend() {
        if (activeEffect) {
            this.effects.add(activeEffect);
        }
    }
    //派发依赖
    notify() {
        this.effects.forEach(effect => effect());
    }
}
const ref = (value) => {
    return new Dep(value);
}
const effect = (fn) => {
    activeEffect = fn;
    fn();
    activeEffect = null;
}
const a = ref(10)
let b;
effect(() => {
    b = a.value + 1
})
// console.log('b===',b); // b=== 11
// a.value++
// console.log('b===',b);// b=== 12
let targetMap = new Map;

const reactive = (raw) => {
    return new Proxy(raw, {
        get(target, key) {
            let depsMap = targetMap.get(target)
            if (!depsMap) {
                depsMap = new Map();
                targetMap.set(target, depsMap)
            }
            let dep = depsMap.get(key)
            if (!dep) {
                dep = new Dep();
                depsMap.set(key, dep)
            }
            dep.depend()
            return Reflect.get(target, key)
        },
        set(target, key, value) {
            let depsMap = targetMap.get(target)
            if (!depsMap) {
                depsMap = new Map();
                targetMap.set(target, depsMap)
            }
            let dep = depsMap.get(key)
            if (!dep) {
                dep = new Dep();
                depsMap.set(key, dep)
            }
            const result = Reflect.set(target, key, value)
            dep.notify()
            return result
        }
    })
}
let user = reactive({
    age: 11
})
let double;
effect(() => {
    double = user.age * 2
})
console.log('double===', double); // double=== 22
user.age++;
console.log('double===', double); // double=== 24
```